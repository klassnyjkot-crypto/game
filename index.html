<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mini Flappy</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body { margin:0; padding:0; height:100%; background:#87ceeb; }
    canvas { display:block; margin:0 auto; background:linear-gradient(#87ceeb,#bfefff); }
    #overlay { position:fixed; left:10px; top:10px; font-family:sans-serif; color:#fff; font-weight:700; text-shadow:0 1px 0 #000; }
    #btn { position:fixed; right:10px; top:10px; padding:6px 10px; background:#222; color:#fff; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <div id="overlay">Score: <span id="score">0</span></div>
  <div id="btn">Tap / Click</div>
  <canvas id="c"></canvas>

<script>
/* --- URL сервера для отправки очков --- */
const SCORE_POST_URL = 'https://tg-game-bot-o4sx.onrender.com/score'; // <- замени на свой Render URL
/* ------------------------------------ */

function getQueryParam(name) {
  const q = (location.search ? location.search : location.hash.split('?').slice(1).join('?'));
  if (!q) return null;
  const params = new URLSearchParams(q);
  return params.get(name);
}
const TOKEN = getQueryParam('token') || '';

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
function fit() {
  canvas.width = Math.min(window.innerWidth, 600);
  canvas.height = Math.min(window.innerHeight-40, 800);
}
fit(); window.addEventListener('resize', fit);

let bird = { x:80, y:150, vy:0, w:20, h:16 };
let pipes = [];
let frame = 0;
let score = 0;
let alive = true;
const GRAV = 0.45;
const FLAP = -8;

document.getElementById('btn').addEventListener('click', () => flap());
document.addEventListener('keydown', e => { if (e.code==='Space') flap(); });
canvas.addEventListener('touchstart', e => { e.preventDefault(); flap(); }, {passive:false});

function flap(){ 
  if (!alive) reset(); 
  bird.vy = FLAP; 
}

function spawnPipe() {
  const gap = 120;
  const minY = 60, maxY = canvas.height - 60 - gap;
  const y = Math.floor(Math.random()*(maxY-minY))+minY;
  pipes.push({x:canvas.width, yTop: y, gap});
}

function update(){
  if (alive) { // обновляем только если птица жива
    frame++;
    if (frame % 90 === 0) spawnPipe();

    bird.vy += GRAV;
    bird.y += bird.vy;

    for (let p of pipes) p.x -= 3 + Math.min(3, Math.floor(score / 10));

    if (pipes.length && pipes[0].x < -60) {
      pipes.shift();
      score++;
